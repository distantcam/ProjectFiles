# <img src="https://raw.githubusercontent.com/SimonCropp/ProjectFiles/master/src/icon.png" height="40px"> ProjectFiles Source Generator

[![Build status](https://ci.appveyor.com/api/projects/status/mwwl3xe6drr2gn2a/branch/main?svg=true)](https://ci.appveyor.com/project/SimonCropp/projectfiles)
[![NuGet Status](https://img.shields.io/nuget/v/ProjectFiles.svg)](https://www.nuget.org/packages/ProjectFiles/)


A C# source generator that provides strongly-typed, compile-time access to project files marked with `CopyToOutputDirectory` in the `.csproj` file.

Creates a type-safe API for accessing files that are copied to the projects output directory, eliminating magic strings and providing IntelliSense support for file paths.

**See [Milestones](../../milestones?state=closed) for release notes.**


## NuGet package

https://nuget.org/packages/ProjectFiles/

    PM> Install-Package ProjectFiles


## Features

- **Strongly-typed access** to project files via generated classes and properties
- **Compile-time safety** - typos in file paths become compilation errors
- **IntelliSense support** - discover available files through IDE autocomplete
- **Automatic synchronization** - regenerates when project files change
- **Hierarchical structure** - mirrors the project's directory structure
- **Glob pattern support** - handles wildcard patterns including `**` recursive patterns
- **Smart naming** - converts file/directory names to valid C# identifiers


## Setup

Mark files with `CopyToOutputDirectory` set to either `PreserveNewest` or `Always`:

```xml
<ItemGroup>
  <None Update="Config\appsettings.json">
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </None>
  
  <Content Include="RecursiveDirectory\**\*.txt">
    <CopyToOutputDirectory>Always</CopyToOutputDirectory>
  </Content>
  
  <None Include="SpecificDirectory\Dir1\*.txt">
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </None>
</ItemGroup>
```


## Generated Code Structure

The generator creates three files:

1. **`ProjectFiles.g.cs`** - Main entry point with directory structure
2. **`ProjectFiles.ProjectDirectory.g.cs`** - Base class for directory types
3. **`ProjectFiles.ProjectFile.g.cs`** - Base class for file types


### Generated API Example

Given the following project structure:
```
Config/
  appsettings.json
RecursiveDirectory/
  SomeFile.txt
  SubDir/
    NestedFile.txt
SpecificDirectory/
  Dir1/
    File1.txt
    File2.txt
  Dir2/
    File4.txt
  File3.txt
```

The generator produces:

```csharp
// <auto-generated/>
#nullable enable

using ProjectFilesGenerator.Types;

namespace ProjectFilesGenerator
{
    /// <summary>Provides strongly-typed access to project files marked with CopyToOutputDirectory.</summary>
    static partial class ProjectFiles
    {
        public static ConfigType Config { get; } = new();
        public static RecursiveDirectoryType RecursiveDirectory { get; } = new();
        public static SpecificDirectoryType SpecificDirectory { get; } = new();
    }
}

namespace ProjectFilesGenerator.Types
{
    partial class ConfigType() : ProjectDirectory("Config")
    {
        public ProjectFile appsettings_json { get; } = new("Config/appsettings.json");
    }
    
    partial class RecursiveDirectoryType() : ProjectDirectory("RecursiveDirectory")
    {
        public SubDirType SubDir { get; } = new();
        public partial class SubDirType
        {
            public ProjectFile NestedFile_txt { get; } = new("RecursiveDirectory/SubDir/NestedFile.txt");
        }

        public ProjectFile SomeFile_txt { get; } = new("RecursiveDirectory/SomeFile.txt");
    }
    
    partial class SpecificDirectoryType() : ProjectDirectory("SpecificDirectory")
    {
        public Dir1Type Dir1 { get; } = new();
        public partial class Dir1Type
        {
            public ProjectFile File1_txt { get; } = new("SpecificDirectory/Dir1/File1.txt");
            public ProjectFile File2_txt { get; } = new("SpecificDirectory/Dir1/File2.txt");
        }

        public Dir2Type Dir2 { get; } = new();
        public partial class Dir2Type
        {
            public ProjectFile File4_txt { get; } = new("SpecificDirectory/Dir2/File4.txt");
        }

        public ProjectFile File3_txt { get; } = new("SpecificDirectory/File3.txt");
    }
}
```


## Usage


### Basic File Access

```csharp
// Access a file
var configFile = ProjectFiles.Config.appsettings_json;

// Get the file path
string path = configFile.Path;  // "Config/appsettings.json"

// Read the file
string json = File.ReadAllText(configFile.Path);
```


### Navigating Directories

```csharp
// Navigate through nested directories
var nestedFile = ProjectFiles.RecursiveDirectory.SubDir.NestedFile_txt;

// Access directory information
var directory = ProjectFiles.SpecificDirectory;
string dirPath = directory.Path;  // "SpecificDirectory"
```


### Working with Multiple Files

```csharp
// Access multiple files in the same directory
var dir1 = ProjectFiles.SpecificDirectory.Dir1;
var file1 = dir1.File1_txt;
var file2 = dir1.File2_txt;

// Use in LINQ queries
var allFiles = new[]
{
    dir1.File1_txt,
    dir1.File2_txt,
    ProjectFiles.SpecificDirectory.File3_txt
};

foreach (var file in allFiles)
{
    Console.WriteLine($"Processing: {file.Path}");
}
```


## Naming Conventions

The generator follows these rules when converting file and directory names to C# identifiers:


### Directory Names → Class Names (PascalCase)

- **Valid characters preserved**: `MyDirectory` → `MyDirectory`
- **Invalid characters replaced**: `my-directory` → `MyDirectory`
- **Hyphens capitalize next letter**: `lower-case` → `LowerCase`
- **Leading digits prefixed**: `123folder` → `_123folder`
- **Keywords escaped**: `class` → `@class`


### File Names → Property Names (PascalCase with extension)

- **Name converted to identifier**: `appsettings.json` → `appsettings_json`
- **Extension lowercased with underscore**: `File.txt` → `File_txt`
- **Multiple dots preserved**: `app.config.json` → `app_config_json`
- **Special characters replaced**: `my-file.xml` → `MyFile_xml`


### Examples

| Original Name | Generated Identifier | Type |
|--------------|---------------------|------|
| `Config` | `ConfigType` | Class |
| `lower-case` | `LowerCaseType` | Class |
| `appsettings.json` | `appsettings_json` | Property |
| `NestedFile.txt` | `NestedFile_txt` | Property |
| `my-config.xml` | `MyConfig_xml` | Property |
| `2024-data` | `_2024Data` | Class |


## Glob Pattern Support

The generator supports standard glob patterns:

### Wildcards

```xml
<!-- Single directory with wildcards -->
<None Include="Config\*.json">
  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</None>
```

### Recursive Patterns

```xml
<!-- All files in directory tree -->
<Content Include="Templates\**\*.html">
  <CopyToOutputDirectory>Always</CopyToOutputDirectory>
</Content>
```

### Mixed Patterns

```xml
<!-- Specific pattern in subdirectories -->
<None Include="Data\**\schema.json">
  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</None>
```


## Base Classes

These base classes can be extened with additional functionality by creating partial class definitions.


### `ProjectDirectory`

Base class for all generated directory types:

<!-- snippet: ProjectDirectory.cs -->
<a id='snippet-ProjectDirectory.cs'></a>
```cs
namespace ProjectFilesGenerator;

abstract partial class ProjectDirectory(string path)
{
    public string Path { get; } = path;

    public override string ToString() => Path;

    public static implicit operator string(ProjectDirectory temp) =>
        temp.Path;

    public static implicit operator FileInfo(ProjectDirectory temp) =>
        new(temp.Path);

    public IEnumerable<string> EnumerateDirectories() =>
        Directory.EnumerateDirectories(Path);

    public IEnumerable<string> EnumerateFiles() =>
        Directory.EnumerateFiles(Path);

    public IEnumerable<string> GetFiles() =>
        Directory.GetFiles(Path);

    public IEnumerable<string> GetDirectories() =>
        Directory.GetDirectories(Path);

    public DirectoryInfo Info => new(Path);
}
```
<sup><a href='/src/ProjectFiles/ProjectDirectory.cs#L1-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectDirectory.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### `ProjectFile`

Class for all generated file instances:

<!-- snippet: ProjectFile.cs -->
<a id='snippet-ProjectFile.cs'></a>
```cs
namespace ProjectFilesGenerator;

partial class ProjectFile(string path)
{
    public string Path { get; } = path;

    public override string ToString() => Path;

    public static implicit operator string(ProjectFile temp) =>
        temp.Path;

    public static implicit operator FileInfo(ProjectFile temp) =>
        new(temp.Path);

    public FileStream OpenRead() =>
        File.OpenRead(Path);

    public StreamReader OpenText() =>
        File.OpenText(Path);

    public string ReadAllText() =>
        File.ReadAllText(Path);

    public Task<string> ReadAllTextAsync() =>
        File.ReadAllTextAsync(Path);

    public FileInfo Info => new(Path);
}
```
<sup><a href='/src/ProjectFiles/ProjectFile.cs#L1-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-ProjectFile.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Troubleshooting

### Files Not Appearing

1. **Verify `CopyToOutputDirectory` is set**: Only files with `PreserveNewest` or `Always` are included
2. **Check `.csproj` is in AdditionalFiles**: The generator needs access to the project file
3. **Rebuild the project**: Sometimes the generator needs a clean rebuild to detect changes


### Path Separators

The generator normalizes all paths to use forward slashes (`/`) in the generated code, regardless of the platform. This ensures consistent behavior across Windows, Linux, and macOS.


## Performance Considerations

- **Minimal runtime overhead**: All types are instantiated once as static properties
- **No reflection**: Direct string property access for maximum performance
- **Compile-time generation**: Zero runtime code generation or discovery


## Icon

[File](https://thenounproject.com/icon/file-8149149/) designed by [Liberus PJ](https://thenounproject.com/creator/liberus-pj/) from [The Noun Project](https://thenounproject.com).
